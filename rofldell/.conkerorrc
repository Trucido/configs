/* -*- JavaScript -*-
   $Id: .conkerorrc,v 1.1.2 2013/12/08 12:31:10 xoddf2 Exp $ */

// Crash recovery
require("session.js");
session_auto_save_auto_load = true;

// Proxy
session_pref('network.proxy.http', "localhost");
session_pref('network.proxy.http_port', 8123);
session_pref('network.proxy.ssl', "localhost");
session_pref('network.proxy.ssl_port', 8123);

// Functions
function echo_message(window, message) {
    window.minibuffer.message(message);
}

interactive("proxy-toggle", "Toggles between the proxy and a direct connection.",
	    function (I) {
		var p = "network.proxy.type";
		if (get_pref(p)) {
		    session_pref(p, 0);
		    echo_message(I.window, "Proxy disabled");
		}
		else {
		    session_pref(p, 1);
		    echo_message(I.window, "Proxy enabled");
		}
	    });

interactive("javascript-toggle", "Toggles JavaScript enabled and disabled.",
	    function (I) {
		var p = "javascript.enabled";
		if (get_pref(p)) {
		    session_pref(p, false);
		    echo_message(I.window, "JavaScript disabled");
		}
		else {
		    session_pref(p, true);
		    echo_message(I.window, "JavaScript enabled");
		}
	    });

// Make C-x C-c less dangerous
add_hook("before_quit_hook",
         function () {
             var w = get_recent_conkeror_window();
             var result = (w == null) ||
                 "y" == (yield w.minibuffer.read_single_character_option(
                     $prompt = "Quit Conkeror? (y/n)",
                     $options = ["y", "n"]));
             yield co_return(result);
         });

add_hook("window_before_close_hook",
         function (w) {
             var result = yield w.minibuffer.read_single_character_option(
                 $prompt = "Close window? (y/n)",
                 $options = ["y", "n"]);
             yield co_return(result == "y");
         });

// External editor
editor_shell_command = "emacsclient";
view_source_use_external_editor = true;

// Downloads
download_buffer_automatic_open_target = OPEN_NEW_BUFFER_BACKGROUND;

external_content_handlers.set("video/*", "urxvtc -e mplayer");
external_content_handlers.set("audio/*", "urxvtc -e mplayer");
external_content_handlers.set("application/ogg", "urxvtc -e mplayer");
external_content_handlers.set("img/*", "feh");

// Favicon
require("favicon");
add_hook("mode_line_hook", mode_line_adder(buffer_icon_widget), true);
read_buffer_show_icons = true;

// Options specific to certain Web sites
xkcd_add_title = true;

// Searches
define_webjump("duckduckgo", "https://duckduckgo.com/lite/?q=%s");

// Disable clock
remove_hook("mode_line_hook", mode_line_adder(clock_widget));

// Keybindings
define_key(content_buffer_normal_keymap, "f2", "proxy-toggle");
define_key(content_buffer_normal_keymap, "f4", "javascript-toggle");
